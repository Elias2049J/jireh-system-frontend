<div class="modal-backdrop fade show"></div>

<div class="modal d-block">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          {{ actionType === 'add' ? 'Nuevo Insumo' : 'Editar Insumo' }}
        </h5>
        <button type="button" class="btn-close" (click)="cancel()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="supplyForm">
          <div class="mb-3">
            <label for="name" class="form-label">Nombre</label>
            <input
              type="text"
              class="form-control"
              id="name"
              formControlName="name"
              [ngClass]="{'is-invalid': supplyForm.get('name')?.invalid && supplyForm.get('name')?.touched}"
            >
            @if (supplyForm.controls['name'].hasError('required') && supplyForm.controls['name'].touched) {
              <div class="invalid-feedback">El nombre es obligatorio</div>
            }
            @if (supplyForm.controls['name'].hasError('minlength')) {
              <div class="invalid-feedback">El nombre debe tener al menos 3 caracteres</div>
            }
          </div>

          <div class="mb-3">
            <label for="type" class="form-label">Tipo de Insumo</label>
            <select
              class="form-select"
              id="type"
              formControlName="type"
              [ngClass]="{'is-invalid': supplyForm.get('type')?.invalid && supplyForm.get('type')?.touched}"
            >
              <option value="">Seleccione un tipo</option>
              <option value="INGREDIENT">Ingrediente</option>
              <option value="UTENSIL">Utensilio</option>
              <option value="CLEANING">Limpieza</option>
              <option value="CONSUMABLE">Consumible</option>
              <option value="TOOL">Herramienta</option>
            </select>
            @if (supplyForm.controls['type'].hasError('required') && supplyForm.controls['type'].touched) {
              <div class="invalid-feedback">El tipo de insumo es obligatorio</div>
            }
          </div>

          <div class="mb-3">
            <label for="unitType" class="form-label">Unidad de Medida</label>

            @if (!showCustomUnitType) {
              <div class="d-flex gap-2">
                <select
                  class="form-select"
                  id="unitType"
                  formControlName="unitType"
                  [ngClass]="{'is-invalid': supplyForm.get('unitType')?.invalid && supplyForm.get('unitType')?.touched}"
                >
                  <option value="">Seleccione una unidad</option>
                  <option value="kg">Kilogramos</option>
                  <option value="g">Gramos</option>
                  <option value="l">Litros</option>
                  <option value="ml">Mililitros</option>
                  <option value="unidad">Unidad</option>
                </select>
                <button type="button" class="btn btn-outline-secondary" (click)="toggleCustomUnitType()">Otro</button>
              </div>
            } @else {
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="customUnitType"
                  formControlName="unitType"
                  placeholder="Especifique la unidad"
                  [ngClass]="{'is-invalid': supplyForm.get('unitType')?.invalid && supplyForm.get('unitType')?.touched}"
                >
                <button class="btn btn-outline-secondary" type="button" (click)="returnToUnitTypeSelect()">Volver</button>
              </div>
            }

            @if (supplyForm.controls['unitType'].hasError('required') && supplyForm.controls['unitType'].touched) {
              <div class="invalid-feedback d-block">La unidad de medida es obligatoria</div>
            }
          </div>

          <div class="mb-3">
            <label for="minStock" class="form-label">Stock Mínimo</label>
            <input
              type="number"
              class="form-control"
              id="minStock"
              formControlName="minStock"
              [ngClass]="{'is-invalid': supplyForm.get('minStock')?.invalid && supplyForm.get('minStock')?.touched}"
            >
            @if (supplyForm.controls['minStock'].hasError('required') && supplyForm.controls['minStock'].touched) {
              <div class="invalid-feedback">El stock mínimo es obligatorio</div>
            }
            @if (supplyForm.controls['minStock'].hasError('min')) {
              <div class="invalid-feedback">El stock mínimo no puede ser negativo</div>
            }
          </div>

          <div class="mb-3">
            <label for="stock" class="form-label">Stock Actual</label>
            <input
              type="number"
              class="form-control"
              id="stock"
              formControlName="stock"
              [ngClass]="{'is-invalid': supplyForm.get('stock')?.invalid && supplyForm.get('stock')?.touched}"
            >
            @if (supplyForm.controls['stock'].hasError('required') && supplyForm.controls['stock'].touched) {
              <div class="invalid-feedback">El stock actual es obligatorio</div>
            }
            @if (supplyForm.controls['stock'].hasError('min')) {
              <div class="invalid-feedback">El stock actual no puede ser negativo</div>
            }
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-secondary" (click)="cancel()">Cancelar</button>
            <button type="button" class="btn btn-primary" (click)="submit()" [disabled]="supplyForm.invalid">
              {{ actionType === 'add' ? 'Registrar' : 'Actualizar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
